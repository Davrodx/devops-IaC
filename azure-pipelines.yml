trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  azureSubscription: 'ARM-Manager'
  location: 'eastus'
  namePrefix: 'CareerPortfolio'
  tenantId: 'ed4ea245-6155-4c12-a192-b87bc12e9cc5'
  objectId: '8cc342d9-1d50-4a28-abd9-25ef76d9d4d4'

stages:
- stage: DeployInfrastructure
  jobs:
  - job: Deploy
    steps:
    - task: AzureCLI@2
      inputs:
        azureSubscription: $(azureSubscription)
        scriptType: bash
        scriptLocation: inlineScript
        inlineScript: |
          az --version
          az deployment group create \
            --resource-group $(namePrefix)-rg \
            --template-file infra/main.bicep \
            --parameters namePrefix=$(namePrefix) location=$(location) tenantId=$(tenantId) objectId=$(objectId)
      displayName: 'Deploy Bicep Infrastructure'
